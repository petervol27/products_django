<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>My Shop</title>
  </head>
  <body class="text-center">
    <nav class="navbar bg-dark navbar-expand-sm navbar-dark">
      <div class="container-fluid">
        <a href="./index.html" class="navbar-brand">My Shop</a>

        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a href="./addProduct.html" class="nav-link">Add Product</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container w-25 mt-3">
      <form class="d-flex" id="searchProductForm">
        <input
          class="form-control me-2"
          type="text"
          placeholder="Search for Product"
          id="searchProductQuery"
        />
        <button class="btn btn-info" type="submit" id="searchProductBtn">
          Search
        </button>
      </form>
    </div>
    <div
      class="container mt-3 d-flex justify-content-between align-items-center gap-5"
    >
      <div class="w-50 align-self-start">
        <h2>Product List:</h2>
        <ul class="list-group" id="product-list"></ul>
      </div>
      <div class="w-50 align-self-start">
        <h2>Categories List:</h2>
        <ul class="list-group" id="categories-list"></ul>
      </div>
    </div>
  </body>
</html>
<script>
  let productList = document.getElementById('product-list');
  let categoriesList = document.getElementById('categories-list');

  const fetchProducts = async () => {
    const response = await axios.get('http://127.0.0.1:8000/products/');
    products = response.data;
    productList.innerHTML = '';
    products.forEach((product) => {
      const productItem = document.createElement('a');
      productItem.className = 'list-group-item list-group-item-action';
      productItem.href = `singleProduct.html?product=${product.id}`;
      productItem.innerHTML = `<p><strong>${product.name}</strong>: ${product.description}<br> Price: ${product.price}$ </p>`;
      productList.appendChild(productItem);
    });
  };
  const fetchCategories = async () => {
    const response = await axios.get('http://127.0.0.1:8000/categories/');
    categories = response.data;
    categoriesList.innerHtml = '';
    categories.forEach((category) => {
      const categoryItem = document.createElement('a');
      categoryItem.className = 'list-group-item list-group-item-action';
      categoryItem.href = `singleCategory.html?category=${category.id}`;
      categoryItem.innerHTML = `<p><strong>${category.name}</strong><br> Rating: ${category.popularity}â˜… </p>`;
      categoriesList.appendChild(categoryItem);
    });
  };
  const fetchAll = async () => {
    await fetchCategories();
    await fetchProducts();
  };
  window.onload = fetchAll();
  const searchProduct = async (event) => {
    event.preventDefault();
    const searchQuery = document.getElementById('searchProductQuery').value;
    const response = await axios.get(
      `http://127.0.0.1:8000/products/?search=${searchQuery}`
    );
    const products = response.data;
    productList.innerHTML = '';
    products.forEach((product) => {
      const productItem = document.createElement('a');
      productItem.className = 'list-group-item list-group-item-action';
      productItem.href = `singleProduct.html?product=${product.id}`;
      productItem.innerHTML = `<p><strong>${product.name}</strong>: ${product.description}<br> Price: ${product.price}$ </p>`;
      productList.appendChild(productItem);
    });
  };
  document
    .getElementById('searchProductForm')
    .addEventListener('submit', searchProduct);
</script>
